(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{143:()=>{},2009:()=>{},2603:()=>{},3052:()=>{},6837:()=>{},7462:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>i});var l=t(5155),a=t(2115),r=t(6747);let c=null;function n(){return c||(c=(0,r.TkF)("object-detection","Xenova/detr-resnet-50")),c}function i(){let[e,s]=(0,a.useState)(!1),[t,r]=(0,a.useState)(!1),[c,i]=(0,a.useState)(null),[x,d]=(0,a.useState)(null),m=(0,a.useRef)(null),o=(0,a.useRef)(null),u=(0,a.useCallback)(async(e,s)=>{d(null),r(!0);try{let t=await n(),l=(await t(e,{threshold:.3})).map(e=>({score:e.score,label:e.label,box:e.box}));i(l);let a=o.current;if(!a)return;a.width=s.naturalWidth,a.height=s.naturalHeight;let r=a.getContext("2d");if(!r)return;r.clearRect(0,0,a.width,a.height),r.drawImage(s,0,0,a.width,a.height),r.lineWidth=2,r.font="16px system-ui, -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif",l.forEach(e=>{let{xmin:s,ymin:t,xmax:l,ymax:a}=e.box,c=l-s,n=a-t;r.strokeStyle="#22c55e",r.fillStyle="rgba(34,197,94,0.15)",r.fillRect(s,t,c,n),r.strokeRect(s,t,c,n);let i=`${e.label} ${(100*e.score).toFixed(1)}%`,x=r.measureText(i).width+8;r.fillStyle="#22c55e",r.fillRect(s,Math.max(0,t-20),x,20),r.fillStyle="#0a0a0a",r.fillText(i,s+4,Math.max(14,t-6))})}catch(e){console.error(e),d(e?.message??"推論中にエラーが発生しました")}finally{r(!1)}},[]),h=(0,a.useCallback)(async e=>{let s=e.currentTarget;await u(s.src,s)},[u]),f=(0,a.useCallback)(async e=>{let s=e.target.files?.[0];if(!s)return;i(null);let t=URL.createObjectURL(s),l=m.current;l&&(l.src=t)},[]);return(0,a.useEffect)(()=>{let e=!1;return(async()=>{try{s(!0),await n(),e||s(!1)}catch(t){e||(console.error(t),s(!1))}})(),()=>{e=!0}},[]),(0,l.jsx)("div",{className:"min-h-screen bg-zinc-950 text-zinc-50",children:(0,l.jsxs)("main",{className:"mx-auto flex max-w-4xl flex-col gap-8 px-4 py-10 sm:px-8",children:[(0,l.jsxs)("header",{className:"space-y-3",children:[(0,l.jsx)("h1",{className:"text-3xl font-semibold tracking-tight sm:text-4xl",children:"Transformers.js Object Detection Demo"}),(0,l.jsx)("p",{className:"max-w-2xl text-sm text-zinc-400 sm:text-base",children:"画像をアップロードすると、ブラウザだけで Hugging Face の DETR モデルを使って物体検知を行います。 データはサーバーに送信されず、WASM 上でローカル推論されます。"}),(0,l.jsxs)("div",{className:"flex flex-wrap gap-3 text-xs text-zinc-400 sm:text-sm",children:[(0,l.jsx)("span",{className:"rounded-full border border-zinc-700 px-3 py-1",children:"WebAssembly / WebGPU 対応ブラウザ推奨"}),e?(0,l.jsx)("span",{className:"rounded-full border border-amber-500/50 bg-amber-500/10 px-3 py-1 text-amber-300",children:"モデル読み込み中（初回のみ数十秒かかることがあります）"}):(0,l.jsx)("span",{className:"rounded-full border border-emerald-500/40 bg-emerald-500/10 px-3 py-1 text-emerald-300",children:"モデル準備完了"})]})]}),(0,l.jsxs)("section",{className:"flex flex-col gap-6 rounded-2xl border border-zinc-800 bg-zinc-900/60 p-5 sm:p-6",children:[(0,l.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsx)("h2",{className:"text-base font-medium text-zinc-100 sm:text-lg",children:"画像をアップロード"}),(0,l.jsx)("p",{className:"text-xs text-zinc-400 sm:text-sm",children:"人や物が写っている写真を選んでください。ブラウザ内でのみ処理されます。"})]}),(0,l.jsxs)("label",{className:"inline-flex cursor-pointer items-center justify-center rounded-full bg-zinc-100 px-4 py-2 text-sm font-medium text-zinc-900 transition hover:bg-white",children:["画像を選択",(0,l.jsx)("input",{type:"file",accept:"image/*",className:"hidden",onChange:f})]})]}),(0,l.jsx)("div",{className:"relative overflow-hidden rounded-xl border border-zinc-800 bg-zinc-950",children:(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4 p-4 sm:p-6",children:[(0,l.jsxs)("div",{className:"relative w-full max-w-xl",children:[(0,l.jsx)("canvas",{ref:o,className:"h-auto w-full rounded-lg bg-zinc-900"}),(0,l.jsx)("img",{ref:m,alt:"uploaded",className:"hidden",onLoad:h})]}),t&&(0,l.jsx)("p",{className:"text-xs text-zinc-400 sm:text-sm",children:"推論中…（ブラウザ内で計算しています）"}),x&&(0,l.jsx)("p",{className:"text-xs text-rose-300 sm:text-sm",children:x}),!t&&!c&&(0,l.jsx)("p",{className:"text-xs text-zinc-500 sm:text-sm",children:"まだ画像が選択されていません。上のボタンから画像をアップロードしてください。"})]})}),c&&c.length>0&&(0,l.jsxs)("div",{className:"space-y-2 rounded-xl border border-zinc-800 bg-zinc-950/60 p-4",children:[(0,l.jsx)("h3",{className:"text-sm font-medium text-zinc-100 sm:text-base",children:"検出結果"}),(0,l.jsx)("ul",{className:"flex flex-wrap gap-2 text-xs sm:text-sm",children:c.map((e,s)=>(0,l.jsxs)("li",{className:"rounded-full border border-emerald-500/40 bg-emerald-500/10 px-3 py-1 text-emerald-200",children:[e.label," (",(100*e.score).toFixed(1),"%)"]},`${e.label}-${s}`))})]})]}),(0,l.jsx)("footer",{className:"mt-4 text-xs text-zinc-500 sm:text-sm",children:"このデモは Next.js + Transformers.js で構成されており、推論はすべてブラウザ内の WASM / WebGPU 上で実行されます。"})]})})}r._K2.allowLocalModels=!1,r._K2.backends.onnx.wasm.numThreads=1},7806:()=>{},8938:(e,s,t)=>{Promise.resolve().then(t.bind(t,7462))}},e=>{e.O(0,[811,138,31,660,441,794,358],()=>e(e.s=8938)),_N_E=e.O()}]);