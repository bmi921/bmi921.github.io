"use strict";(self.webpackChunkyuruchara_quiz=self.webpackChunkyuruchara_quiz||[]).push([[400],{6400:(O,l,s)=>{s.r(l),s.d(l,{QuizModule:()=>$});var C=s(4341),h=s(177),p=s(3536),t=s(8699),b=s(205),f=s(8554);function v(e,r){1&e&&(t.j41(0,"h4",3),t.EFF(1,"\u6b63\u89e3\uff01 \u{1f389}"),t.k0s())}function x(e,r){if(1&e&&(t.j41(0,"h4",4),t.EFF(1," \u4e0d\u6b63\u89e3 \u274c "),t.nrm(2,"br"),t.EFF(3),t.k0s()),2&e){const n=t.XpG();t.R7$(3),t.SpI("\u6b63\u89e3\u306f ",n.correctAnswer," \u3067\u3057\u305f ")}}let z=(()=>{class e{constructor(n){this.bsModalRef=n}ngOnInit(){setTimeout(()=>this.bsModalRef.hide(),1e3)}static{this.\u0275fac=function(i){return new(i||e)(t.rXU(f.Y$))}}static{this.\u0275cmp=t.VBU({type:e,selectors:[["app-confirm"]],decls:3,vars:2,consts:[[1,"modal-body","text-center","p-4"],["class","text-success",4,"ngIf"],["class","text-danger",4,"ngIf"],[1,"text-success"],[1,"text-danger"]],template:function(i,o){1&i&&(t.j41(0,"div",0),t.DNE(1,v,2,0,"h4",1),t.DNE(2,x,4,1,"h4",2),t.k0s()),2&i&&(t.R7$(1),t.Y8G("ngIf",o.isCorrect),t.R7$(1),t.Y8G("ngIf",!o.isCorrect))},dependencies:[h.bT],encapsulation:2})}}return e})(),y=(()=>{class e{constructor(n){this.modalService=n}show(n,i){return this.bsModalRef=this.modalService.show(z,{initialState:{isCorrect:n,correctAnswer:i}}),this.bsModalRef}static{this.\u0275fac=function(i){return new(i||e)(t.KVO(f.I8))}}static{this.\u0275prov=t.jDH({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var g=s(1626),F=s(6354);let I=(()=>{class e{constructor(n){this.http=n,this.apiUrl="https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent"}getCompletion(n){const i={contents:[{parts:[{text:n}]}]},o=new g.Lr({"Content-Type":"application/json","X-goog-api-key":"AIzaSyAGtSeeCh9AY2mw0kqN4zOKn8kdH_EQ8uk"});return this.http.post(this.apiUrl,i,{headers:o}).pipe((0,F.T)(c=>c.candidates[0].content.parts[0].text))}static{this.\u0275fac=function(i){return new(i||e)(t.KVO(g.Qq))}}static{this.\u0275prov=t.jDH({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function S(e,r){1&e&&(t.j41(0,"div",4)(1,"p"),t.EFF(2,"\u51fa\u984c\u7bc4\u56f2\u304c\u3042\u308a\u307e\u305b\u3093\u3002\u8a2d\u5b9a\u753b\u9762\u3067\u90fd\u9053\u5e9c\u770c\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044\u3002"),t.k0s()())}function E(e,r){1&e&&(t.j41(0,"div",5)(1,"div",6)(2,"span",7),t.EFF(3,"Loading..."),t.k0s()()())}function Q(e,r){if(1&e){const n=t.RV6();t.j41(0,"button",18),t.bIt("click",function(){t.eBV(n);const o=t.XpG(2);return t.Njj(o.getHint())}),t.EFF(1," \u30d2\u30f3\u30c8\u3092\u898b\u308b "),t.k0s()}}function j(e,r){1&e&&(t.j41(0,"div",22)(1,"span",7),t.EFF(2,"Loading..."),t.k0s()())}function k(e,r){if(1&e&&(t.j41(0,"p"),t.EFF(1),t.k0s()),2&e){const n=t.XpG(3);t.R7$(1),t.JRh(n.hint)}}function w(e,r){if(1&e&&(t.j41(0,"div",19),t.DNE(1,j,3,0,"div",20),t.DNE(2,k,2,1,"p",21),t.k0s()),2&e){const n=t.XpG(2);t.R7$(1),t.Y8G("ngIf",n.isHintLoading),t.R7$(1),t.Y8G("ngIf",!n.isHintLoading)}}function T(e,r){if(1&e){const n=t.RV6();t.j41(0,"button",23),t.bIt("click",function(){const c=t.eBV(n).$implicit,a=t.XpG(2);return t.Njj(a.register(c))}),t.EFF(1),t.k0s()}if(2&e){const n=r.$implicit;t.R7$(1),t.SpI(" ",n," ")}}const q=function(e){return{hidden:e}};function M(e,r){if(1&e&&(t.j41(0,"div",8)(1,"div",9),t.nrm(2,"img",10),t.k0s(),t.j41(3,"div",11)(4,"h2",12),t.EFF(5),t.k0s(),t.j41(6,"div",13),t.DNE(7,Q,2,0,"button",14),t.DNE(8,w,3,2,"div",15),t.k0s(),t.j41(9,"div",16),t.DNE(10,T,2,1,"button",17),t.k0s()()()),2&e){const n=t.XpG();t.R7$(2),t.Y8G("src",n.currentCharacter.imagePath,t.B4B)("alt",n.currentCharacter.name)("ngClass",t.eq3(7,q,n.isHiddenImageEnabled)),t.R7$(3),t.JRh(n.questionText),t.R7$(2),t.Y8G("ngIf",n.isHintFeatureEnabled&&!n.isHintVisible),t.R7$(1),t.Y8G("ngIf",n.isHintVisible),t.R7$(2),t.Y8G("ngForOf",n.choices)}}const R=[{path:"",component:(()=>{class e{constructor(n,i,o){this.dataService=n,this.confirmService=i,this.geminiService=o,this.choices=[],this.questionText="",this.loading=!1,this.hint=null,this.isHintLoading=!1,this.isHintVisible=!1,this.isHintFeatureEnabled=!1,this.isHiddenImageEnabled=!1,this.noQuizScope=!1,this.localStorageKey="selectedPrefectures"}ngOnInit(){this.checkQuizScope(),this.noQuizScope||this.loadQuestion(),this.isHintFeatureEnabled=this.dataService.getHintSetting();const n=localStorage.getItem("hiddenImage");this.isHiddenImageEnabled="true"===n}checkQuizScope(){const n=localStorage.getItem(this.localStorageKey);if(n){const i=JSON.parse(n);this.noQuizScope=0===i.length}else this.noQuizScope=!0}loadQuestion(){this.loading=!0,this.currentCharacter=void 0,this.hint=null,this.isHintVisible=!1,this.dataService.getCharacters().subscribe(n=>{const i=localStorage.getItem(this.localStorageKey);let o=n;if(i){const a=JSON.parse(i);a.length>0&&(o=n.filter(u=>a.includes(u.prefecture)))}if(0===o.length)return this.loading=!1,void(this.noQuizScope=!0);const c=this.dataService.generateQuizQuestion(o);if(this.currentCharacter=c.character,this.questionType=c.type,this.questionText=c.question,this.currentCharacter){const a="name"===this.questionType?this.currentCharacter.name:this.currentCharacter.prefecture;let u=[];for(;u.length<3;){const m=n[Math.floor(Math.random()*n.length)],d="name"===this.questionType?m.name:m.prefecture;d!==a&&!u.includes(d)&&u.push(d)}this.choices=this.shuffleArray([a,...u])}this.loading=!1})}getHint(){this.currentCharacter&&(this.isHintLoading=!0,this.isHintVisible=!0,this.geminiService.getCompletion("name"===this.questionType?`\u300c${this.currentCharacter.name}\u300d ${this.currentCharacter.description}\u3002\u3053\u306e\u3086\u308b\u30ad\u30e3\u30e9\u306e\u540d\u524d\u306f\u4f55\uff1f\u3068\u3044\u3046\u30af\u30a4\u30ba\u306e\u30d2\u30f3\u30c8\u3092\u7c21\u6f54\u306b\u6559\u3048\u3066\u3002\u81ea\u5df1\u7d39\u4ecb\u6587\u3001\u6240\u5c5e\u56e3\u4f53\u306f\u30af\u30a4\u30ba\u306e\u56de\u7b54\u8005\u306b\u898b\u305b\u3089\u308c\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u7d39\u4ecb\u6587\u3092\u898b\u3066\u3068\u3044\u3046\u30d2\u30f3\u30c8\u306f\u51fa\u3055\u306a\u3044\u3067\u304f\u3060\u3055\u3044\u3002\u30d2\u30f3\u30c8\uff1a\u3068\u3044\u3046\u30d7\u30ec\u30d5\u30a3\u30c3\u30af\u30b9\u306f\u4f7f\u308f\u306a\u3044\u3067\u3002markdown\u8a18\u6cd5\u306f\u4f7f\u308f\u306a\u3044\u3067\u3002\u7b87\u6761\u66f8\u304d\u306f\u3084\u3081\u3066\u3002`:`\u300c${this.currentCharacter.name}\u300d${this.currentCharacter.description}\u3002\u3053\u306e\u3086\u308b\u30ad\u30e3\u30e9\u306e\u51fa\u8eab\u770c\u306f\u3069\u3053\uff1f\u3068\u3044\u3046\u30af\u30a4\u30ba\u306e\u30d2\u30f3\u30c8\u3092\u7c21\u6f54\u306b\u6559\u3048\u3066\u3002\u81ea\u5df1\u7d39\u4ecb\u6587\u3001\u6240\u5c5e\u56e3\u4f53\u306f\u30af\u30a4\u30ba\u306e\u56de\u7b54\u8005\u306b\u898b\u305b\u3089\u308c\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u7d39\u4ecb\u6587\u3092\u898b\u3066\u3068\u3044\u3046\u30d2\u30f3\u30c8\u306f\u51fa\u3055\u306a\u3044\u3067\u304f\u3060\u3055\u3044\u3002\u7d76\u5bfe\u306b\u51fa\u8eab\u770c\u3092\u30d2\u30f3\u30c8\u306b\u3057\u306a\u3044\u3067\u3002\u30d2\u30f3\u30c8\uff1a\u3068\u3044\u3046\u30d7\u30ec\u30d5\u30a3\u30c3\u30af\u30b9\u306f\u4f7f\u308f\u306a\u3044\u3067\u3002markdown\u8a18\u6cd5\u306f\u4f7f\u308f\u306a\u3044\u3067\u3002\u7b87\u6761\u66f8\u304d\u306f\u3084\u3081\u3066\u3002`).subscribe({next:i=>{this.hint=i,this.isHintLoading=!1},error:i=>{console.error("Error getting hint:",i),this.hint="\u30d2\u30f3\u30c8\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002",this.isHintLoading=!1}}))}shuffleArray(n){return n.map(i=>({value:i,sort:Math.random()})).sort((i,o)=>i.sort-o.sort).map(({value:i})=>i)}register(n){if(!this.currentCharacter)return;const i="name"===this.questionType?this.currentCharacter.name:this.currentCharacter.prefecture,o=n===i;this.dataService.addAnswerLog(o?"correct":"wrong",this.currentCharacter);const c=this.confirmService.show(o,i);c&&c.onHidden?.subscribe(()=>{this.loadQuestion()})}static{this.\u0275fac=function(i){return new(i||e)(t.rXU(b.u),t.rXU(y),t.rXU(I))}}static{this.\u0275cmp=t.VBU({type:e,selectors:[["app-quiz"]],decls:4,vars:3,consts:[[1,"setting-container"],["class","no-scope-message d-flex justify-content-center m-5",4,"ngIf"],["class","d-flex justify-content-center m-5",4,"ngIf"],["class","card quiz-card",4,"ngIf"],[1,"no-scope-message","d-flex","justify-content-center","m-5"],[1,"d-flex","justify-content-center","m-5"],["role","status",1,"spinner-border"],[1,"visually-hidden"],[1,"card","quiz-card"],[1,"quiz-image-container"],[1,"quiz-image",3,"src","alt","ngClass"],[1,"quiz-content"],[1,"quiz-question"],[1,"hint-section"],["class","btn btn-info",3,"click",4,"ngIf"],["class","hint-content",4,"ngIf"],[1,"quiz-choices"],["type","button","class","btn btn-outline-primary choice-button",3,"click",4,"ngFor","ngForOf"],[1,"btn","btn-info",3,"click"],[1,"hint-content"],["class","spinner-border spinner-border-sm","role","status",4,"ngIf"],[4,"ngIf"],["role","status",1,"spinner-border","spinner-border-sm"],["type","button",1,"btn","btn-outline-primary","choice-button",3,"click"]],template:function(i,o){1&i&&(t.j41(0,"div",0),t.DNE(1,S,3,0,"div",1),t.DNE(2,E,4,0,"div",2),t.DNE(3,M,11,9,"div",3),t.k0s()),2&i&&(t.R7$(1),t.Y8G("ngIf",o.noQuizScope),t.R7$(1),t.Y8G("ngIf",o.loading&&!o.noQuizScope),t.R7$(1),t.Y8G("ngIf",!o.loading&&o.currentCharacter&&!o.noQuizScope))},dependencies:[h.YU,h.Sq,h.bT],styles:[".setting-container[_ngcontent-%COMP%]{padding:20px;max-width:600px;margin:0 auto}.quiz-card[_ngcontent-%COMP%]{background-color:#fff;border-radius:8px;box-shadow:0 4px 8px #0000001a;overflow:hidden;width:100%;max-width:500px;display:flex;flex-direction:column;align-items:center;padding:20px;text-align:center}.quiz-image-container[_ngcontent-%COMP%]{width:100%;padding-bottom:100%;position:relative;margin-bottom:20px}.quiz-image[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;border-radius:10px}.quiz-content[_ngcontent-%COMP%]{width:100%}.quiz-question[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;margin-bottom:25px;color:#333}.quiz-choices[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:center;gap:15px}.choice-button[_ngcontent-%COMP%]{flex-grow:1;min-width:120px;font-size:1rem;padding:12px 20px;border-radius:8px;transition:all .3s ease}.choice-button[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 8px #0000001a}.hint-section[_ngcontent-%COMP%]{margin:20px 0;min-height:40px;display:flex;justify-content:center;align-items:center}.hint-content[_ngcontent-%COMP%]{color:#666;font-style:italic}.no-scope-message[_ngcontent-%COMP%]{background-color:#fff3cd;border:1px solid #ffeeba;border-radius:8px;padding:15px 20px;color:#856404;font-size:1.1rem;text-align:center;box-shadow:0 2px 4px #0000000d}.spinner-border[_ngcontent-%COMP%]{color:#007bff}.quiz-image.hidden[_ngcontent-%COMP%]{filter:blur(20px)}"]})}}return e})()}];let H=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=t.$C({type:e})}static{this.\u0275inj=t.G2t({imports:[p.iI.forChild(R),p.iI]})}}return e})(),$=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=t.$C({type:e})}static{this.\u0275inj=t.G2t({imports:[h.MD,H,C.YN]})}}return e})()}}]);